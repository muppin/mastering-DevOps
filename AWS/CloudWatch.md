## CloudWatch

**CloudWatch is a service which watches/monitors other services in AWS Cloud.**

- It is basically a gate-keeper/watchman for AWS cloud.
- It watches the activities that are being performed on AWS cloud.
- It helps in
   -  Monitoring
   -  Alerting
   -  Reporting
   -  Logging
- It provides
   - Real life metrics (How many API requests did my application receive, give me cpu utilisation for last 30 minutes)
   - Alalrming - to take actions on metrics outcome
   - Log Insights - it tells, this specific service tried to access this particular service
   - Custom metrics - memory utilisation, this metric has be explicitly sent to cloudwatch.
   - Cost Optimisation - cloud watch plays a critical role in cost optmisation.
   - scaling - when CPU utilisation crosses 80%, it sends the notification to ASG to bring up a new instance.

### CloudWatch Metrics

- Is a variable to monitor.
- Metrics have a timestamp.
- Dimension is an attribute of a metric, can have upto 30 dimensions per metric. eg. (instance id, environment etc)
- CloudWatch metrics can be streamed in near-real time to Kinesis Data Firehose or any other 3rd party party service provider such as datadog, splunk.
- If u enable **Detailed Monitoring**, we can get data of every 1 minute.
  
### CloudWatch Logs

- **Log Groups** - Log groups help organize and manage the logs generated by your applications and AWS resources.
- **Log stream** - A log stream is a sequence of log events that share the same source. Each log stream belongs to a log group.
- All the logs are encrypted by default.

### CloudWatch LogInsights

- Search and analyse data stored in ClodWatch Logs
- with the help of query

### CloudWatch Alarms

- Alarms are used to trigger notifications for any metric
- you can configure to trigger notification when the metric(CPU utilisation) crosses certain threshold.
- you can create a SNS topic to send a notification to mail id.

### CloudWatch Log Subscription

- Get real time log events from CloudWatch logs for processing and analysis.

### CloudWatch Logs for EC2

- By default, no logs from your EC2 machine will go to CloudWatch.
- You need to run a CloudWatch agent on EC2 to push the log files you want.
- The CloudWatch log agent can be setup on-premises too

**********************************************************************************************************************************

### Explain how to configure cloud watch alarms on EC2


Configuring CloudWatch alarms on EC2 instances involves setting up alarms that monitor specific metrics and take actions based on those metrics. Here’s a step-by-step guide on how to configure CloudWatch alarms for EC2 instances:

### Step 1: Open CloudWatch Console
1. Sign in to the AWS Management Console.
2. Open the CloudWatch console by selecting **CloudWatch** from the AWS Management Console.

### Step 2: Create an Alarm
1. In the CloudWatch console, click on **Alarms** in the navigation pane on the left.
2. Click on the **Create alarm** button.

### Step 3: Select Metric
1. Click on the **Select metric** button.
2. Choose **EC2** from the list of available services.
3. Select **Per-Instance Metrics** to view metrics for individual EC2 instances.
4. Choose the specific EC2 instance and the metric you want to monitor (e.g., CPUUtilization, DiskReadOps, NetworkIn, etc.).
5. Click **Select metric**.

### Step 4: Configure Alarm
1. **Specify metric and conditions**:
   - **Metric name**: The name of the metric you selected (e.g., `CPUUtilization`).
   - **Statistic**: Choose an appropriate statistic (e.g., `Average`).
   - **Period**: The evaluation period for the metric (e.g., `5 minutes`).
   - **Conditions**: Set the threshold type and value for the alarm (e.g., `Greater than 80%` for CPUUtilization).
   - **Data points to alarm**: The number of consecutive periods the condition must be met (e.g., `3 out of 5`).

2. **Configure actions**:
   - **Send notification to**: Choose an existing SNS topic or create a new one to send notifications when the alarm state changes.
   - **Auto Scaling action**: (Optional) Configure an Auto Scaling action to add or remove instances in an Auto Scaling group.
   - **EC2 action**: (Optional) Choose to stop, terminate, reboot, or recover the EC2 instance when the alarm state changes.

3. **Define alarm state**:
   - **OK**: The state when the metric is within the defined threshold.
   - **ALARM**: The state when the metric breaches the defined threshold.
   - **INSUFFICIENT DATA**: The state when there is not enough data to determine the alarm state.

### Step 5: Review and Create Alarm
1. Review the settings and configuration of the alarm.
2. Click on the **Create alarm** button to create the alarm.

### Example: Creating a CPU Utilization Alarm
Let’s create an example alarm to monitor CPU utilization of an EC2 instance and send an email notification if CPU usage exceeds 80% for more than 5 minutes.

1. **Metric**: `CPUUtilization`
2. **Statistic**: `Average`
3. **Period**: `5 minutes`
4. **Threshold**: `Greater than 80`
5. **Data points to alarm**: `2 out of 2`
6. **Actions**: Send notification to an SNS topic (e.g., `HighCPUNotification`).

### Configuring SNS Topic for Notifications
1. **Create SNS Topic**:
   - Open the SNS console from the AWS Management Console.
   - Click on **Create topic**.
   - Enter a name for the topic (e.g., `HighCPUNotification`).
   - Click on **Create topic**.

2. **Subscribe to SNS Topic**:
   - Click on the created topic.
   - Click on **Create subscription**.
   - Choose **Email** as the protocol.
   - Enter the email address to receive notifications.
   - Click on **Create subscription**.
   - Confirm the subscription from the email received.

### Verification
1. Generate a high CPU load on the EC2 instance to test the alarm.
2. Verify that you receive the notification via email when the CPU utilization exceeds 80%.

By following these steps, you can configure CloudWatch alarms on EC2 instances to monitor specific metrics and automate actions based on those metrics.


  
